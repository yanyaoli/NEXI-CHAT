<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXI CHAT</title>

    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="css/layout.css">
    <style>
        .channel-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background-color: #f0f2f5;
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
            margin-right: 8px;
        }

        .fa-loaded .channel-icon i {
            font-size: 14px;
            display: inline-block;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
        }

        .fa-loaded .channel-icon .fa-lock {
            font-size: 14px;
        }
    </style>

    <script>
        (function () {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css';
            link.onload = function () {
                document.documentElement.classList.add('fa-loaded');
                console.log('Font AwesomeåŠ è½½å®Œæˆï¼Œå·²åˆ‡æ¢ä¸ºå›¾æ ‡æ ·å¼');
            };
            link.onerror = function () {
                console.log('Font AwesomeåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°CSSæ•°å­—æ ·å¼');
            };
            document.head.appendChild(link);
        })();
    </script>

    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="images/logo.png" alt="NEXI CHAT" class="app-title">
                <button id="settingsBtn" class="settings-btn">âš™ï¸</button>
            </div>

            <div class="user-profile">
                <div class="avatar-container">
                    <img id="userAvatar" src="images/default.png" alt="Avatar" class="avatar">
                </div>
                <div class="user-info">
                    <h3 id="username">ç”¨æˆ·</h3>
                    <p id="userBio" class="bio">è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆä¹Ÿæ²¡ç•™ä¸‹</p>
                </div>
            </div>

            <div class="channels">
                <h2 class="section-title">é¢‘é“</h2>
                <div class="channel-list">
                    <div class="channel-item" data-channel="General">
                        <span class="channel-icon">1<i class="fa-solid fa-1" style="display: none;"></i></span>
                        <span class="channel-name">é¢‘é“1</span>
                    </div>
                    <div class="channel-item" data-channel="Technology">
                        <span class="channel-icon">2<i class="fa-solid fa-2" style="display: none;"></i></span>
                        <span class="channel-name">é¢‘é“2</span>
                    </div>
                    <div class="channel-item" data-channel="Gaming">
                        <span class="channel-icon">3<i class="fa-solid fa-3" style="display: none;"></i></span>
                        <span class="channel-name">é¢‘é“3</span>
                    </div>
                    <div class="channel-item" data-channel="Music">
                        <span class="channel-icon">4<i class="fa-solid fa-4" style="display: none;"></i></span>
                        <span class="channel-name">é¢‘é“4</span>
                    </div>
                    <div class="channel-item" data-channel="Random">
                        <span class="channel-icon">5<i class="fa-solid fa-5" style="display: none;"></i></span>
                        <span class="channel-name">é¢‘é“5</span>
                    </div>
                    <div class="channel-item" data-channel="Channel105">
                        <span class="channel-icon">ğŸ”’<i class="fa-solid fa-lock" style="display: none;"></i></span>
                        <span class="channel-name">105ä¸“ç”¨é¢‘é“</span>
                    </div>
                </div>
            </div>

            <button id="logoutBtn" class="logout-btn">é€€å‡ºç™»å½•</button>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <div class="current-channel">
                    <span id="currentChannelIcon" class="channel-icon"></span>
                    <h2 id="currentChannelName">è¯·é€‰æ‹©é¢‘é“</h2>
                </div>
                <div id="more" onclick="showMore();">
                    <span>ä¸‰</span>
                </div>
                <div id="mobileNav" class="nav" onclick="showMore();" hidden>
                    <div class="card">
                        <div class="user-profile">
                            <div class="user-info">
                                <div class="avatar-container">
                                    <img onclick="openUserProfile(currentUser.id);" id="userAvatarMobile"
                                        src="images/default.png" alt="Avatar" class="avatar">
                                </div>
                                <div>
                                    <h3 id="usernameMobile">ç”¨æˆ·</h3>
                                    <p id="userBioMobile" class="bio">è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆä¹Ÿæ²¡ç•™ä¸‹</p>
                                </div>
                            </div>
                            <button onclick="settingsPanel.classList.add('open');" class="settings-btn">âš™ï¸</button>
                        </div>
                        <div class="channel-list">
                            <div class="channel-item" data-channel="General">
                                <span class="channel-icon">1<i class="fa-solid fa-1" style="display: none;"></i></span>
                                <span class="channel-name">é¢‘é“1</span>
                            </div>
                            <div class="channel-item" data-channel="Technology">
                                <span class="channel-icon">2<i class="fa-solid fa-2" style="display: none;"></i></span>
                                <span class="channel-name">é¢‘é“2</span>
                            </div>
                            <div class="channel-item" data-channel="Gaming">
                                <span class="channel-icon">3<i class="fa-solid fa-3" style="display: none;"></i></span>
                                <span class="channel-name">é¢‘é“3</span>
                            </div>
                            <div class="channel-item" data-channel="Music">
                                <span class="channel-icon">4<i class="fa-solid fa-4" style="display: none;"></i></span>
                                <span class="channel-name">é¢‘é“4</span>
                            </div>
                            <div class="channel-item" data-channel="Random">
                                <span class="channel-icon">5<i class="fa-solid fa-5" style="display: none;"></i></span>
                                <span class="channel-name">é¢‘é“5</span>
                            </div>
                            <div class="channel-item" data-channel="Channel105">
                                <span class="channel-icon">ğŸ”’<i class="fa-solid fa-lock"
                                        style="display: none;"></i></span>
                                <span class="channel-name">105ä¸“ç”¨é¢‘é“</span>
                            </div>
                        </div>
                        <button id="logoutBtn" class="logout-btn">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>

            <div id="messagesContainer" class="messages-container">
            </div>

            <div class="message-input-container">
                <div class="input-tools">
                    <label for="imageUpload" class="upload-btn">ğŸ–¼ï¸</label>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    <button id="emojiBtn" class="emoji-btn">ğŸ˜Š</button>
                    <div id="emojiPicker" class="emoji-picker">
                        <div class="emoji-grid">
                            <!-- Emoji will be dynamically populated by JavaScript -->
                        </div>
                    </div>
                    <button id="voiceBtn" class="voice-btn" title="å‘é€è¯­éŸ³">ğŸ¤</button>
                    <div id="uploadProgress" class="upload-progress"></div>
                </div>
                <textarea id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off" rows="1"></textarea>
                <button id="sendBtn" class="send-btn">å‘é€</button>
            </div>
        </div>
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-header">
                <h2>ä¸ªäººè®¾ç½®</h2>
                <button id="closeSettings" class="close-btn">âœ•</button>
            </div>

            <div class="settings-content">
                <div class="settings-section">
                    <h3>å¤´åƒè®¾ç½®</h3>
                    <div class="avatar-upload">
                        <div class="avatar-preview">
                            <img id="avatarPreview" src="images/default.png" alt="Avatar" class="avatar">
                        </div>
                        <label for="avatarInput" class="btn-secondary">ä¸Šä¼ å¤´åƒ</label>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>ä¸ªäººä¿¡æ¯</h3>
                    <div class="form-group">
                        <label for="settingsUsername">ç”¨æˆ·å</label>
                        <input type="text" id="settingsUsername" disabled>
                    </div>
                    <div class="form-group">
                        <label for="settingsNickname">ç¤¾äº¤æ˜µç§°</label>
                        <input type="text" id="settingsNickname" placeholder="æ˜¾ç¤ºç»™å…¶ä»–ç”¨æˆ·çš„åå­—">
                    </div>
                    <div class="form-group">
                        <label for="settingsBio">ä¸ªæ€§ç­¾å</label>
                        <textarea id="settingsBio" rows="3" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±å§..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="settingsGender">æ€§åˆ«</label>
                        <select id="settingsGender">
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="settingsEmail">é‚®ç®±</label>
                        <input type="email" id="settingsEmail" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>æ¶ˆæ¯é€šçŸ¥è®¾ç½®</h3>
                    <div class="form-group">
                        <label for="notificationSound">æç¤ºéŸ³å¼€å…³</label>
                        <div class="toggle-switch-container">
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationSound">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æ¥æ”¶é€šçŸ¥çš„é¢‘é“</label>
                        <div class="channel-notification-settings">
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">é¢‘é“1</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannelGeneral" value="General" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">é¢‘é“2</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannelTechnology" value="Technology" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">é¢‘é“3</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannelGaming" value="Gaming" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">é¢‘é“4</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannelMusic" value="Music" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">é¢‘é“5</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannelRandom" value="Random" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            <div class="channel-notification-item">
                                <label class="channel-toggle-container">
                                    <span class="channel-toggle-name">105ä¸“ç”¨é¢‘é“</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="notifyChannel105" value="Channel105" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>å®‰å…¨è®¾ç½®</h3>
                    <div class="security-actions">
                        <button id="changePasswordBtn" class="btn-secondary">æ›´æ”¹å¯†ç </button>
                    </div>
                </div>

                <!-- å±è”½è¯ç®¡ç†åŠŸèƒ½å·²ç§»é™¤ï¼Œä¸å‘æ™®é€šç”¨æˆ·å¼€æ”¾ -->

                <div class="settings-actions">
                    <button id="saveSettings" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                </div>
            </div>
        </div>

        <div id="passwordChangePanel" class="settings-panel">
            <div class="settings-header">
                <h2>æ›´æ”¹å¯†ç </h2>
                <button id="closePasswordPanel" class="close-btn">âœ•</button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <form id="passwordChangeForm">
                        <div class="form-group">
                            <label for="currentPassword">å½“å‰å¯†ç </label>
                            <input type="password" id="currentPassword" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">æ–°å¯†ç </label>
                            <input type="password" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç " required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">ç¡®è®¤æ–°å¯†ç </label>
                            <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
                        </div>
                        <div class="settings-actions">
                            <button type="submit" class="btn-primary">ç¡®è®¤æ›´æ”¹</button>
                            <button type="button" id="cancelPasswordChange" class="btn-secondary">å–æ¶ˆ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- é€šçŸ¥æç¤ºå®¹å™¨ -->
        <div id="notificationContainer" class="notification-container"></div>

        <div id="userProfileModal" class="profile-modal">
            <div class="profile-content">
                <div class="profile-header">
                    <h2>ç”¨æˆ·èµ„æ–™</h2>
                    <button id="closeProfileModal" class="close-btn">âœ•</button>
                </div>
                <div class="profile-info">
                    <div class="avatar-container">
                        <img id="profileAvatar" src="images/default.png" alt="Avatar" class="avatar">
                    </div>
                    <h3 id="profileUsername">ç¤¾äº¤æ˜µç§°</h3>
                    <p id="profileBio">ä¸ªæ€§ç­¾å</p>
                    <p id="profileGender">æ€§åˆ«</p>
                    <p id="profileEmail">é‚®ç®±</p>
                    <p id="profileJoined">åŠ å…¥æ—¶é—´</p>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="utils/bilibili_video.js"></script>
    <script src="js/chat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (document.documentElement.classList.contains('fa-loaded')) {
                switchToFAIcons();
            } else {
                const observer = new MutationObserver(function (mutations) {
                    mutations.forEach(function (mutation) {
                        if (mutation.attributeName === 'class' && document.documentElement.classList.contains('fa-loaded')) {
                            switchToFAIcons();
                            observer.disconnect();
                        }
                    });
                });
                observer.observe(document.documentElement, { attributes: true });
            }

            function switchToFAIcons() {
                const channelIcons = document.querySelectorAll('.channel-icon');
                channelIcons.forEach(icon => {
                    icon.style.fontSize = '0';
                    const faIcon = icon.querySelector('i');
                    if (faIcon) {
                        faIcon.style.display = 'inline-block';
                        faIcon.style.fontSize = '14px';
                    }
                });
            }

            document.querySelectorAll('.channel-item').forEach(item => {
                item.addEventListener('click', function () {
                    const channelNum = this.querySelector('.channel-name').textContent.replace('é¢‘é“', '');
                    const iconEl = document.getElementById('currentChannelIcon');
                    iconEl.innerHTML = `${channelNum}<i class="fa-solid fa-${channelNum}" style="display: none;"></i>`;
                    if (document.documentElement.classList.contains('fa-loaded')) {
                        iconEl.style.fontSize = '0';
                        iconEl.querySelector('i').style.display = 'inline-block';
                        iconEl.querySelector('i').style.fontSize = '14px';
                    }
                });
            });
        });
    </script>
</body>

</html>